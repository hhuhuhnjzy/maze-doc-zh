.. _quick_start:

å¿«é€Ÿå…¥é—¨
========

æœ¬æŒ‡å—å°†å¼•å¯¼æ‚¨è¿è¡Œä¸€ä¸ªå®Œæ•´çš„ Maze ç¤ºä¾‹ï¼š**è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆå·¥ä½œæµ**ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ `test.py` ä¸­çš„ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•å®šä¹‰ä»»åŠ¡ã€æ„å»ºä¾èµ–å…³ç³»å›¾ï¼ˆDAGï¼‰ã€æäº¤å·¥ä½œæµï¼Œå¹¶è·å–æœ€ç»ˆç»“æœã€‚

è¯¥å·¥ä½œæµåŒ…å«ä»¥ä¸‹å››ä¸ªä»»åŠ¡ï¼š
1.  **åˆ›å»ºåˆå§‹æŠ¥å‘Š**
2.  **æ·»åŠ åˆ†æç« èŠ‚**
3.  **æ·»åŠ æ€»ç»“ç« èŠ‚**
4.  **æ•´åˆå¹¶ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š**

é€šè¿‡æœ¬ç¤ºä¾‹ï¼Œæ‚¨å°†ä½“éªŒ Maze çš„æ ¸å¿ƒç‰¹æ€§ï¼š**ä»»åŠ¡çº§è°ƒåº¦**ã€**ä¾èµ–è‡ªåŠ¨è§£æ** å’Œ **å¹¶è¡Œæ‰§è¡Œèƒ½åŠ›**ã€‚

å‰ææ¡ä»¶
--------

è¯·ç¡®ä¿å·²å®Œæˆ :ref:`installation` ä¸­çš„æ‰€æœ‰æ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š

- å·²å®‰è£… `torch`ã€`ray` ç­‰ä¾èµ–
- å·²æ‰§è¡Œ `pip install -r requirements.txt` å’Œ `pip install -e .`
- ï¼ˆæœåŠ¡å™¨æ¨¡å¼ï¼‰å·²é…ç½® `config/config.toml` ä¸­çš„ `project_root`

æ­¥éª¤ 1ï¼šå®šä¹‰ä»»åŠ¡å‡½æ•°
--------------------

åœ¨ Maze ä¸­ï¼Œæ¯ä¸ªè®¡ç®—æ­¥éª¤éƒ½é€šè¿‡ `@task` è£…é¥°å™¨å®šä¹‰ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯æœ¬ç¤ºä¾‹ä¸­çš„å››ä¸ªä»»åŠ¡å‡½æ•°ï¼š

.. code-block:: python
   :linenos:

   from maze.library.tasks.definitions import task
   import time

   @task(
       name="create_initial_report",
       description="åˆ›å»ºä¸€ä¸ªåˆå§‹æŠ¥å‘Šï¼Œä½œä¸ºå·¥ä½œæµçš„èµ·ç‚¹ã€‚",
       task_type='cpu',
       input_parameters={"properties": {"reporter_name": {"type": "string"}}},
       output_parameters={"properties": {"report_content": {"type": "string"}}}
   )
   def create_report(reporter_name: str) -> str:
       print(f"--- ä»»åŠ¡ [create_initial_report] æ­£åœ¨æ‰§è¡Œ ---")
       report = f"Initial report generated by {reporter_name}."
       print(f"--- ä»»åŠ¡ [create_initial_report] å®Œæˆ ---")
       return report

   @task(
       name="add_analysis_section",
       description="åœ¨æŠ¥å‘Šä¸­æ·»åŠ åˆ†æç« èŠ‚ã€‚",
       task_type='cpu',
       input_parameters={"properties": {"base_report": {"type": "string"}}},
       output_parameters={"properties": {"updated_report": {"type": "string"}}}
   )
   def add_analysis(base_report: str) -> str:
       print(f"--- ä»»åŠ¡ [add_analysis_section] æ­£åœ¨æ‰§è¡Œ ---")
       time.sleep(2)  # æ¨¡æ‹Ÿè€—æ—¶çš„æ•°æ®åˆ†æ
       updated_report = base_report + "\nSection: Data Analysis - Analysis complete."
       print(f"--- ä»»åŠ¡ [add_analysis_section] å®Œæˆ ---")
       return updated_report

   @task(
       name="add_summary_section",
       description="åœ¨æŠ¥å‘Šä¸­æ·»åŠ æ€»ç»“ç« èŠ‚ã€‚",
       task_type='cpu',
       input_parameters={"properties": {"base_report": {"type": "string"}}},
       output_parameters={"properties": {"updated_report": {"type": "string"}}}
   )
   def add_summary(base_report: str) -> str:
       print(f"--- ä»»åŠ¡ [add_summary_section] æ­£åœ¨æ‰§è¡Œ ---")
       time.sleep(3)  # æ¨¡æ‹Ÿè€—æ—¶çš„æ€»ç»“ç”Ÿæˆ
       updated_report = base_report + "\nSection: Summary - Summary complete."
       print(f"--- ä»»åŠ¡ [add_summary_section] å®Œæˆ ---")
       return updated_report

   @task(
       name="finalize_report",
       description="æ•´åˆæ‰€æœ‰ç« èŠ‚ï¼Œå½¢æˆæœ€ç»ˆæŠ¥å‘Šã€‚",
       task_type='cpu',
       input_parameters={
           "properties": {
               "analysis_report": {"type": "string"},
               "summary_report": {"type": "string"}
           }
       },
       output_parameters={"properties": {"final_report": {"type": "string"}}}
   )
   def finalize_report(analysis_report: str, summary_report: str) -> str:
       print(f"--- ä»»åŠ¡ [finalize_report] æ­£åœ¨æ‰§è¡Œ ---")
       final_report = f"--- FINAL REPORT ---\n{analysis_report}\n{summary_report.splitlines()[-1]}"
       print(f"--- ä»»åŠ¡ [finalize_report] å®Œæˆ ---")
       return final_report
è¯´æ˜ï¼š

@task è£…é¥°å™¨ç”¨äºæ³¨å†Œä»»åŠ¡ï¼Œå¯æŒ‡å®šåç§°ã€æè¿°ã€èµ„æºç±»å‹ï¼ˆtask_typeï¼‰å’Œè¾“å…¥/è¾“å‡ºå‚æ•°ã€‚
add_analysis å’Œ add_summary é€šè¿‡ time.sleep() æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼Œä½“ç°ä»»åŠ¡çº§è°ƒåº¦çš„ä¼˜åŠ¿ã€‚
è¿™ä¸¤ä¸ªä»»åŠ¡å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬äº’ä¸ä¾èµ–ã€‚
æ­¥éª¤ 2ï¼šåˆ›å»ºå®¢æˆ·ç«¯å¹¶å®šä¹‰å·¥ä½œæµ
ä½¿ç”¨ MazeClient è¿æ¥åˆ° Maze æœåŠ¡ï¼Œå¹¶é€šè¿‡ new_workflow() åˆ›å»ºä¸€ä¸ªå·¥ä½œæµå¯¹è±¡ã€‚

.. code-block:: python

Mazeå®¢æˆ·ç«¯
print("ğŸš€ [Step 1] Connecting to Maze Server...")
SERVER_ADDRESS = "127.0.0.1:6380"
client = MazeClient(server_address=SERVER_ADDRESS)
print("âœ… [Step 1] Connection successful.\n")

åˆ›å»ºworkflow
print("ğŸš€ [Step 2] Defining workflow blueprint...")
report_workflow = client.new_workflow(name="Simple Report Generation Workflow")


æ­¥éª¤ 3ï¼šæ·»åŠ ä»»åŠ¡å¹¶å®šä¹‰ä¾èµ–å…³ç³»
------------------------------

ä½¿ç”¨ `add_task()` æ–¹æ³•å°†ä»»åŠ¡æ·»åŠ åˆ°å·¥ä½œæµä¸­ï¼Œå¹¶é€šè¿‡ `{task_id}.output.{field}` è¯­æ³•å£°æ˜ä¾èµ–ã€‚

.. code-block:: python

   # 1. æ·»åŠ èµ·å§‹ä»»åŠ¡
   task_a_id = report_workflow.add_task(
       create_report,
       task_name="Create Initial Report",
       inputs={'reporter_name': 'MazeBot'}
   )

   # 2. æ·»åŠ åˆ†æä»»åŠ¡ï¼Œä¾èµ–äºèµ·å§‹ä»»åŠ¡çš„è¾“å‡º
   task_b_id = report_workflow.add_task(
       add_analysis,
       task_name="Add Analysis Section",
       inputs={'base_report': f'{task_a_id}.output.report_content'}
   )

   # 3. æ·»åŠ æ€»ç»“ä»»åŠ¡ï¼Œä¹Ÿä¾èµ–äºèµ·å§‹ä»»åŠ¡çš„è¾“å‡º
   task_c_id = report_workflow.add_task(
       add_summary,
       task_name="Add Summary Section",
       inputs={'base_report': f'{task_a_id}.output.report_content'}
   )

   # 4. æ·»åŠ æœ€ç»ˆä»»åŠ¡ï¼Œä¾èµ–äºåˆ†æå’Œæ€»ç»“ä»»åŠ¡çš„è¾“å‡º
   final_task_id = report_workflow.add_task(
       finalize_report,
       task_name="Finalize The Report",
       inputs={
           'analysis_report': f'{task_b_id}.output.updated_report',
           'summary_report': f'{task_c_id}.output.updated_report'
       }
   )

   print("âœ… [Step 2] Workflow defined.\n")
è¯´æ˜ï¼š

task_a_id æ˜¯ç¬¬ä¸€ä¸ªä»»åŠ¡çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚
f'{task_a_id}.output.report_content' è¡¨ç¤ºè¯¥ä»»åŠ¡çš„è¾“å…¥ä¾èµ–äº create_report ä»»åŠ¡çš„è¾“å‡ºå­—æ®µ report_contentã€‚
ç”±äº add_analysis å’Œ add_summary éƒ½åªä¾èµ– create_reportï¼Œå®ƒä»¬å°†è¢« å¹¶è¡Œè°ƒåº¦æ‰§è¡Œï¼ŒèŠ‚çœæ€»æ‰§è¡Œæ—¶é—´ã€‚
æ­¥éª¤ 4ï¼šå¯è§†åŒ–å·¥ä½œæµç»“æ„ï¼ˆå¯é€‰ï¼‰
------------------------------

æ‚¨å¯ä»¥ä½¿ç”¨ `visualize()` æ–¹æ³•æŸ¥çœ‹ DAG çš„ç»“æ„ï¼Œä¾¿äºè°ƒè¯•å’Œç†è§£ï¼š

.. code-block:: python

   # å¯è§†åŒ–å·¥ä½œæµ
   compact_style = {
       'figsize': (8, 6),
       'title_fontsize': 20,
       'node_size': 5000,
       'node_fontsize': 8,
       'edge_fontsize': 14,
       'arrow_size': 100,
       'line_width': 2.0
   }
   report_workflow.visualize(style_options=compact_style)
è¿™å°†ç”Ÿæˆä¸€ä¸ªå›¾å½¢åŒ–çš„ DAG å›¾ï¼Œæ¸…æ™°å±•ç¤ºä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»ã€‚

æ­¥éª¤ 5ï¼šæäº¤å·¥ä½œæµå¹¶è·å–ç»“æœ
--------------------------

ä½¿ç”¨ `submit()` æ–¹æ³•å°†å·¥ä½œæµæäº¤åˆ° Maze é›†ç¾¤ã€‚

.. code-block:: python

   print("\nğŸš€ [Step 3] Submitting workflow to server...")
   try:
       run_handle = report_workflow.submit(mode="local")  # ä½¿ç”¨æœ¬åœ°æ¨¡å¼
       print(f"âœ… [Step 3] Workflow submitted. Run Handle: {run_handle}\n")
   except (ValueError, RuntimeError) as e:
       print(f"âŒ [Step 3] Workflow validation or submission failed: {e}")
è¿è¡Œæ¨¡å¼è¯´æ˜ï¼š

mode="local"ï¼šåœ¨æœ¬åœ°æ‰§è¡Œï¼Œç”¨äºå¼€å‘è°ƒè¯•ã€‚
mode="server"ï¼šæäº¤åˆ°åˆ†å¸ƒå¼é›†ç¾¤æ‰§è¡Œã€‚
æ­¥éª¤ 6ï¼šç­‰å¾…å¹¶è·å–æœ€ç»ˆç»“æœ
------------------------

ä½¿ç”¨ `get_task_result()` æ–¹æ³•è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚

.. code-block:: python

   print("ğŸš€ [Step 4] Waiting for final task result...")
   result_info = run_handle.get_task_result(final_task_id, wait=True, timeout=300)

   print("\nğŸš€ [Step 5] Processing final result...")
   if result_info.get("task_status") == "finished":
       final_report = result_info.get("data", {}).get("final_report", "No report content found.")
       print("\n--- âœ… Final Report ---")
       print(final_report)
       print("----------------------\n")
   else:
       print(f"Task failed: {result_info.get('error')}")
é¢„æœŸè¾“å‡ºï¼š
.. code-block:: text

--- âœ… Final Report --- --- FINAL REPORT --- Initial report generated by MazeBot. Section: Data Analysis - Analysis complete. Section: Summary - Summary complete.
æ­¥éª¤ 7ï¼šå±•ç¤ºæ‰§è¡Œæ‘˜è¦
æ‚¨å¯ä»¥è°ƒç”¨ display_summary() æŸ¥çœ‹æœ¬æ¬¡è¿è¡Œçš„ç»Ÿè®¡ä¿¡æ¯ï¼š

.. code-block:: python

run_handle.display_summary()

æ­¥éª¤ 8ï¼šæ¸…ç†èµ„æºï¼ˆå¯é€‰ï¼‰
------------------------

æäº¤å®Œæˆåï¼Œå»ºè®®æ¸…ç†æœåŠ¡å™¨ä¸Šçš„è¿è¡Œèµ„æºï¼š

.. code-block:: python

   print(f"\nğŸš€ [Step 6] Cleaning up server resources...")
   if run_handle.destroy():
       print("âœ… [Step 6] Cleanup successful.")
âœ… æ€»ç»“
é€šè¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œæ‚¨å·²ç»å®Œæ•´ä½“éªŒäº† Maze çš„æ ¸å¿ƒåŠŸèƒ½ï¼š

ä½¿ç”¨ @task å®šä¹‰å¯è°ƒåº¦çš„ä»»åŠ¡
ä½¿ç”¨ add_task() å’Œ f"{task_id}.output.{field}" æ„å»º DAG
ä»»åŠ¡è‡ªåŠ¨å¹¶è¡Œæ‰§è¡Œï¼ˆadd_analysis å’Œ add_summaryï¼‰
æäº¤å·¥ä½œæµå¹¶åŒæ­¥è·å–ç»“æœ
ä¸‹ä¸€æ­¥ï¼Œæ‚¨å¯ä»¥å°è¯•å°† mode æ”¹ä¸º "server"ï¼Œå¹¶åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­è¿è¡Œæ­¤å·¥ä½œæµï¼Œä½“éªŒ Maze çš„å¯æ‰©å±•æ€§ã€‚

æ‚¨å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º quick_start_demo.py æ–‡ä»¶ï¼Œå°†ä¸Šè¿°ä»£ç ç‰‡æ®µç»„åˆèµ·æ¥è¿è¡Œã€‚